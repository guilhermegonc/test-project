{% extends "base.html" %}
{% block title %}Gestão financeira{% endblock %}
{% include "chart-js/chart.html"%}

{% load static %}
{% block extra-css %}
<link rel="stylesheet" type="text/css" href="{% static 'finance-styles.css' %}">
{% endblock %}
{% block extra-js %}
    <script src="{% static 'monthly-summary.js' %}"></script>
    <script src="{% static 'edit-modal.js' %}"></script>
    <script src="{% static 'services-dict.js' %}"></script>
    {% endblock %}

{% block content%}
<div class="txt-center m-b-24">
    <div id="summary" class="m-b-24 header-scroll">
    </div>
</div>
<!-- <div class="fl-l btn-full">
    <a class="btn shadow light m-b-12" href="/savings">Economias</a>
</div> -->
<div class="footer-btn fl-r">
    <a class="btn light m-b-12" href="/">Início</a>
</div>
<script>
    const formExpense = `{{ form_expense }}`
    const formSaving = `{{ form_saving }}`
    const token = `{% csrf_token %}`

    const container = document.querySelector('.default-margin-bg')
    container.style.margin = '0'
    
    let expenses = {}
    '{% for k,v in expenses.items %}'
        expenses['{{ k }}'] = {{ v }}
    '{% endfor %}'
    
    let savings = {}
    '{% for k,v in savings.items %}'
        savings['{{ k }}'] = {{ v }}
    '{% endfor %}'

    let dd, mm
    let goals = {}
    '{% for l in limit %}'
        dd = '{{ l.date.day }}'.padStart(2, '0')
        mm = '{{ l.date.month }}'.padStart(2, '0')
        goals[`{{ l.date.year }}-${mm}-${dd}`] = [{{ l.expenses }}, {{ l.savings }}]
    '{% endfor %}'

    const date = new Date()
    yyyy = String(date.getFullYear())
    mm = String(date.getMonth() + 1).padStart(2, '0')

    let div = document.querySelector('#summary')
    let sum = expenses[`${yyyy}-${mm}-01`].toFixed(2)
    let limit = goals[`${yyyy}-${mm}-01`][0].toFixed(2)
    let balance = limit - sum
    new ExpenseCard('expense', formExpense, div, sum, limit, balance)
    
    sum = savings[`${yyyy}-${mm}-01`].toFixed(2)
    limit = goals[`${yyyy}-${mm}-01`][1].toFixed(2)
    balance = limit - sum
    new ExpenseCard('saving', formSaving, div, sum, limit, balance)
    </script>
{% endblock %}