{% extends "base.html" %}
{% block title %}Carteira{% endblock %}

{% load static %}
{% block extra-css %}
<link rel="stylesheet" type="text/css" href="{% static 'stock-styles.css' %}">
{% endblock %}
{% block extra-js %}
    <script src="{% static 'stock-prices.js' %}"></script>
    <script src="{% static 'stock-actions.js' %}"></script>
{% endblock %}

{% block content%}
<div class="featured p-24 light">
    <h1 class="s3 m-0">Carteira</h1>
    <div id="value" class="fl-l p-12">
        <p class="s8 pre-label">Valor da carteira:</p>
        <h3 class="s5"></h3>
    </div>
    <div id="price" class="fl-l p-12">
        <p class="s8 pre-label">Preço da carteira:</p>
        <h3 class="s5"></h3>
    </div>
    <div id="date" class="fl-l p-12">
        <p class="s8 pre-label">Atualizado em:</p>
        <h3 class="s5">{{ stocks.0.close_date.0 }}</h3>
    </div>
</div>
<div class="m-b-24">
    <div class="m-a half-view fl-l">
        <div class="m-b-24 light">
            <h2 class="s6 p-12 m-b-12">Ações</h1>
        </div>
        {% for s in stocks %}
        <div class="db-results p-card shadow p-24 m-12">
            <div id="{{ s.code }}" class="card-btn" href="s/{{ s.code  }}">
                <div class="recommendation-tag"></div>
                <i class="material-icons menu-icon blue fl-r no-hover">edit</i>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="m-a half-view fl-r">
        <div id="recommendations" class="m-b-24">
            <div class="m-b-24 light">
                <h2 class="s6 p-12 m-b-12">Recomendações</h1>
            </div>
        </div>
    </div>
</div>
<div class="fl-l btn-full">
    <a class="btn shadow light" href="/dashboard">Voltar</a>
</div>
<script>
    let stocks = {}
    '{% for s in stocks %}'
        stocks.{{ s.code }} = {
            price: {{ s.price }}, 
            quantity: {{ s.quantity }},
            value: {{ s.value }},
            recommended: `{{ s.recommended }}` == "True"
        }
    '{% endfor %}'
    let recommendations = {}
    '{% for m in momentum %}'
        recommendations.{{ m.code }} = {
            price: {{ m.value }}, 
            growth: {{ m.growth }},
        }
    '{% endfor %}'
    const token = `{% csrf_token %}`
    const forms = `{{ form }}`
    setStocks(stocks, token, forms, recommendations)
</script>
{% endblock %}