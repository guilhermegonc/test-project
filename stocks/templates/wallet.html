{% extends "base.html" %}
{% block title %}{{ user }}{% endblock %}

{% load static %}
{% block extra-js %}
    <script src="{% static 'stock-prices.js' %}"></script>
    <script src="{% static 'stock-actions.js' %}"></script>
{% endblock %}

{% block content%}
<div class="m-a">
    <div class="m-b-24">
        <div class="txt-center m-b-24 light">
            <h1 class="s3 p-12 m-b-12">Carteira {{ stocks.0.close_date.0 }}</h1>
            <p id="info" class="s8 p-12 token w-300 m-a"></p>
        </div>
        <div id="new-purchase" class="db-results p-card shadow m-b-24 p-24">
            <div class="card-btn">
                <i class="material-icons menu-icon fl-r dark no-hover">add</i>
                <p class="s9 str dark m-b-0">Adicionar nova ação ou cotas</p>
                <p class="s9 light-gray m-0">Clique para adicionar</p>
            </div>
        </div>
        {% for s in stocks %}
        <div class="db-results p-card shadow p-24">
            <div id="{{ s.code }}" class="card-btn" href="s/{{ s.code  }}">
                <i class="material-icons menu-icon fl-r blue no-hover">edit</i>
            </div>
        </div>
        {% endfor %}
        </div>
    <div>
        <div id="rec-btn" class="btn shadow light m-b-12">Ver recomendações</a>
    </div>
    <div>
        <a class="btn shadow light" href="/dashboard">Voltar</a>
    </div>

</div>
<script>    
    let stocks = {}
    '{% for s in stocks %}'
        stocks.{{ s.code }} = {
            price: {{ s.price }}, 
            quantity: {{ s.quantity }},
            value: {{ s.value }},
            recommended: `{{ s.recommended }}` == "True"
        }
    '{% endfor %}'

    const token = `{% csrf_token %}`
    const forms = `{{ form }}`

    createBuyingListener(token, forms)
    populateStocks(stocks, token, forms)
    writeSummary(stocks)
    createRecommendationListener(stocks)
</script>
{% endblock %}