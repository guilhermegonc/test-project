{% extends "base.html" %}
{% block title %}{{ user }}{% endblock %}

{% load static %}
{% block extra-js %}
    <script src="{% static 'stock-actions.js' %}"></script>
{% endblock %}

{% block content%}
<div class="m-a">
    <h1 class="s3 p-12 light txt-center m-b-24">Carteira</h1>
    <p id="info"></p>
    <div id="new-purchase" class="db-results p-card shadow m-b-24 p-24">
        <div class="card-btn">
            <i class="material-icons menu-icon fl-r dark no-hover">add</i>
            <p class="s9 str dark m-b-0">Adicionar nova ação ou cotas</p>
            <p class="s9 light-gray m-0">Clique para adicionar</p>    
        </div>
    </div>
    {% for s in stocks %}
    <div id="{{ s.code  }}"class="db-results p-card shadow p-24">
        <div class="card-btn" href="s/{{ s.code  }}">
            <i class="material-icons menu-icon fl-r blue no-hover">edit</i>
            <p class="s9 str blue m-b-0">{{ s.code }} ({{ s.quantity }})</p>
            <p class="s9 light-gray m-0">Preço médio de compra: R${{ s.weighted_average_cost }}</p>    
        </div>
    </div>
    {% endfor %}
</div>
<script>
    const token = `{% csrf_token %}`
    const forms = `{{ form }}`

    const parag = document.querySelector('#info')

    let walletValue = 0
    let walletSize = 0

    document.querySelector('#new-purchase')
    .addEventListener("click", function() {
        addBuyingContent(token, forms)
    });
    
    '{% for s in stocks %}'
        document.querySelector('#{{ s.code  }}')
        .addEventListener("click", function() {
            addSellingContent(token, forms, '{{ s.code  }}')
        });
        walletValue += {{s.weighted_average_cost}}
        walletSize += 1
    '{% endfor %}'

    parag.innerText = 'R$: 'walletValue + ' - ' walletSize 'Empresas'
</script>
{% endblock %}